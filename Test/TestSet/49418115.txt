Large deformation diffeomorphic metric mapping (LDDMM) is a specific suite of algorithms used for diffeomorphic mapping and manipulating dense imagery based on  diffeomorphic metric mapping within the academic discipline of computational anatomy, to be distinguished from its precursor based on diffeomorphic mapping.  The distinction between the two is that diffeomorphic metric maps satisfy the property that the length associated to their flow away from the identity induces a metric on the group of diffeomorphisms, which in turn induces a metric on the orbit of shapes and forms within the field of Computational Anatomy. The study of shapes and forms with the metric of diffeomorphic metric mapping is called diffeomorphometry.
A diffeomorphic mapping system is a system designed to map, manipulate, and transfer information which is stored in many types of spatially distributed medical imagery.
Diffeomorphic mapping is the underlying technology for mapping and analyzing information measured in human anatomical coordinate systems which have been measured via Medical imaging. Diffeomorphic mapping is a broad term that actually refers to a number of different algorithms, processes, and methods. It is attached to many operations and has many applications for analysis and visualization. Diffeomorphic mapping can be used to relate various sources of information which are indexed as a function of spatial position as the key index variable. Diffeomorphisms are by their Latin root structure preserving transformations, which are in turn differentiable and therefore smooth, allowing for the calculation of metric based quantities such as arc length and surface areas. Spatial location and extents in human anatomical coordinate systems can be recorded via a variety of Medical imaging modalities, generally termed multi-modal medical imagery, providing either scalar and or vector quantities at each spatial location. Examples are scalar T1 or T2 magnetic resonance imagery, or as 3x3 diffusion tensor matrices diffusion MRI and diffusion-weighted imaging, to scalar densities associated to computed tomography (CT), or functional imagery such as temporal data of functional magnetic resonance imaging and scalar densities such as Positron emission tomography (PET).
Computational anatomy is a subdiscipline within the broader field of neuroinformatics within bioinformatics and medical imaging. The first algorithm for dense image mapping via diffeomorphic metric mapping was Beg's LDDMM for volumes and Joshi's landmark matching for point sets with correspondence, with LDDMM algorithms now available for computing diffeomorphic metric maps between non-corresponding landmarks and landmark matching intrinsic to spherical manifolds,  curves, currents and surfaces, tensors, varifolds, and time-series. The term LDDMM was first established as part of the National Institutes of Health supported Biomedical Informatics Research Network.In a more general sense, diffeomorphic mapping is any solution that registers or builds correspondences between dense coordinate systems in medical imaging by ensuring the solutions are diffeomorphic. There are now many codes organized around diffeomorphic registration  including ANTS, DARTEL, DEMONS, StationaryLDDMM, FastLDDMM, as examples of actively used computational codes for constructing correspondences between coordinate systems based on dense images.
The distinction between diffeomorphic metric mapping forming the basis for LDDMM and the earliest methods of diffeomorphic mapping is the introduction of a Hamilton principle of least-action in which large deformations are selected of shortest length corresponding to geodesic flows. This important distinction arises from the original formulation of the Riemannian metric corresponding to the right-invariance. The lengths of these geodesics give the metric in the metric space structure of human anatomy. Non-geodesic formulations of diffeomorphic mapping in general does not correspond to any metric formulation.


== History of development ==
Diffeomorphic mapping 3-dimensional information across coordinate systems is central to high-resolution Medical imaging and the area of  Neuroinformatics within the newly emerging field of bioinformatics. Diffeomorphic mapping 3-dimensional coordinate systems as measured via high resolution dense imagery has a long history in 3-D beginning with Computed Axial Tomography (CAT scanning) in the early 80's by the University of Pennsylvania group led by Ruzena Bajcsy, and subsequently the Ulf Grenander school at Brown University with the HAND experiments. In the 90's there were several solutions for image registration which were associated to linearizations of small deformation and non-linear elasticity.The central focus of the sub-field of Computational anatomy (CA) within medical imaging  is mapping information across anatomical coordinate systems at the 1 millimeter morphome scale. In CA mapping of dense information measured within Magnetic resonance image (MRI) based coordinate systems such as in the brain has been solved via inexact matching of 3D MR images one onto the other. The earliest introduction of the use of diffeomorphic mapping via large deformation flows of diffeomorphisms for transformation of coordinate systems in image analysis and medical imaging was by Christensen, Rabbitt and Miller  and Trouve. The introduction of flows, which are akin to the equations of motion used in fluid dynamics, exploit the notion that dense coordinates in image analysis follow the Lagrangian and Eulerian equations of motion. This model becomes more appropriate for cross-sectional studies in which brains and or hearts are not necessarily deformations of one to the other. Methods based on linear or non-linear elasticity energetics which grows with distance from the identity mapping of the template, is not appropriate for cross-sectional study. Rather, in models based on Lagrangian and Eulerian flows of diffeomorphisms, the constraint is associated to topological properties, such as open sets being preserved, coordinates not crossing implying uniqueness and existence of the inverse mapping, and connected sets remaining connected.  The use of diffeomorphic methods grew quickly to dominate the field of mapping methods post Christensen's original paper, with fast and symmetric methods becoming available.Such methods are powerful in that they introduce notions of regularity of the solutions so that they can be differentiated and local inverses can be calculated. The disadvantages of these methods is that there was no associated global least-action property which could score the flows of minimum energy. This contrasts the geodesic motions which are central to the study of  Rigid body kinematics and the many problems solved in Physics via Hamilton's principle of least action. In 1998, Dupuis, Grenander and Miller established the conditions for guaranteeing the existence of solutions for dense image matching in the space of flows of diffeomorphisms. These conditions require an action penalizing kinetic energy measured via the Sobolev norm on spatial derivatives of the flow of vector fields.
The large deformation diffeomorphic metric mapping (LDDMM) code that Faisal Beg derived and implemented for his PhD at Johns Hopkins University developed the earliest algorithmic code  which solved for flows with fixed points satisfying the necessary conditions for the dense image matching problem subject to least-action. Computational anatomy now has many existing codes organized around diffeomorphic registration  including ANTS, DARTEL, DEMONS, LDDMM, StationaryLDDMM as examples of actively used computational codes for constructing correspondences between coordinate systems based on dense images.
These large deformation methods have been extended to landmarks without registration via measure matching, curves, surfaces, dense vector and tensor  imagery, and varifolds removing orientation.


== The diffeomorphism orbit model in computational anatomy ==
Deformable shape in Computational Anatomy (CA)is studied via the use of diffeomorphic mapping for establishing correspondences between anatomical coordinates in Medical Imaging. In this setting, three dimensional medical images are modelled as a random deformation of some exemplar, termed the template 
  
    
      
        
          I
          
            t
            e
            m
            p
          
        
      
    
    {\displaystyle I_{temp}}
  , with the set of observed images element in the random orbit model of CA for images 
  
    
      
        I
        ∈
        
          
            I
          
        
        ≐
        {
        I
        =
        
          I
          
            t
            e
            m
            p
          
        
        ∘
        φ
        ,
        φ
        ∈
        D
        i
        f
        
          f
          
            V
          
        
        }
      
    
    {\displaystyle I\in {\mathcal {I}}\doteq \{I=I_{temp}\circ \varphi ,\varphi \in Diff_{V}\}}
  . The template is mapped onto the target by defining a variational problem in which the template is transformed via the diffeomorphism used as a change of coordinate to minimize a squared-error matching condition between the transformed template and the target.
The diffeomorphisms are generated via smooth flows  
  
    
      
        
          ϕ
          
            t
          
        
        ,
        t
        ∈
        [
        0
        ,
        1
        ]
      
    
    {\displaystyle \phi _{t},t\in [0,1]}
  , with 
  
    
      
        φ
        ≐
        
          ϕ
          
            1
          
        
      
    
    {\displaystyle \varphi \doteq \phi _{1}}
  , satisfying the Lagrangian and Eulerian specification of the flow field associated to the ordinary differential equation,

  
    
      
        
          
            d
            
              d
              t
            
          
        
        
          ϕ
          
            t
          
        
        =
        
          v
          
            t
          
        
        ∘
        
          ϕ
          
            t
          
        
        ,
         
        
          ϕ
          
            0
          
        
        =
        i
        d
      
    
    {\displaystyle {\frac {d}{dt}}\phi _{t}=v_{t}\circ \phi _{t},\ \phi _{0}=id}
  ,with 

  
    
      
        
          v
          
            t
          
        
        ,
        t
        ∈
        [
        0
        ,
        1
        ]
      
    
    {\displaystyle v_{t},t\in [0,1]}
   the Eulerian vector fields determining the flow.
The vector fields are guaranteed to be 1-time continuously differentiable 
  
    
      
        
          v
          
            t
          
        
        ∈
        
          C
          
            1
          
        
      
    
    {\displaystyle v_{t}\in C^{1}}
   by modelling them to be in a 
smooth Hilbert space  
  
    
      
        v
        ∈
        V
      
    
    {\displaystyle v\in V}
   supporting 1-continuous derivative. The inverse 
  
    
      
        
          ϕ
          
            t
          
          
            −
            1
          
        
        ,
        t
        ∈
        [
        0
        ,
        1
        ]
      
    
    {\displaystyle \phi _{t}^{-1},t\in [0,1]}
    is defined by the Eulerian vector-field with flow given by

To ensure smooth flows of diffeomorphisms with inverse,  the vector fields with components in 
  
    
      
        
          
            
              R
            
          
          
            3
          
        
      
    
    {\displaystyle {\mathbb {R} }^{3}}
   must be at least 1-time continuously differentiable in space which are modelled as elements of the Hilbert space  
  
    
      
        (
        V
        ,
        ‖
        ⋅
        
          ‖
          
            V
          
        
        )
      
    
    {\displaystyle (V,\|\cdot \|_{V})}
   using the Sobolev embedding theorems so that each element 
  
    
      
        
          v
          
            i
          
        
        ∈
        
          H
          
            0
          
          
            3
          
        
        ,
        i
        =
        1
        ,
        2
        ,
        3
        ,
      
    
    {\displaystyle v_{i}\in H_{0}^{3},i=1,2,3,}
   has 3-times square-integrable weak-derivatives. Thus 
  
    
      
        (
        V
        ,
        ‖
        ⋅
        
          ‖
          
            V
          
        
        )
      
    
    {\displaystyle (V,\|\cdot \|_{V})}
   embeds smoothly in 1-time continuously differentiable functions.  The diffeomorphism group are flows with vector fields absolutely integrable in Sobolev norm


== The variational problem of dense image matching and sparse landmark matching ==


=== LDDMM algorithm for dense image matching ===
In CA the space of vector fields 
  
    
      
        (
        V
        ,
        ‖
        ⋅
        
          ‖
          
            V
          
        
        )
      
    
    {\displaystyle (V,\|\cdot \|_{V})}
   are modelled as a reproducing Kernel Hilbert space (RKHS) defined by a 1-1, differential operator
  
    
      
        A
        :
        V
        →
        
          V
          
            ∗
          
        
      
    
    {\displaystyle A:V\rightarrow V^{*}}
   determining the norm 
  
    
      
        ‖
        v
        
          ‖
          
            V
          
          
            2
          
        
        ≐
        
          ∫
          
            
              R
              
                3
              
            
          
        
        A
        v
        ⋅
        v
        d
        x
        ,
         
        v
        ∈
        V
         
        ,
      
    
    {\displaystyle \|v\|_{V}^{2}\doteq \int _{R^{3}}Av\cdot vdx,\ v\in V\ ,}
   
where the integral is calculated by integration by parts when 
  
    
      
        A
        v
      
    
    {\displaystyle Av}
   is a generalized function  in the dual space 
  
    
      
        
          V
          
            ∗
          
        
      
    
    {\displaystyle V^{*}}
  . 
The differential operator is selected so that the Green's kernel, the inverse of the operator, is continuously differentiable in each variable implying that the vector fields support 1-continuous derivative; see for the necessary conditions on the norm for existence of solutions.
The original large deformation diffeomorphic metric mapping (LDDMM) algorithms of Beg, Miller, Trouve, Younes was derived taking variations with respect to the vector field parameterization of the group, since 
  
    
      
        v
        =
        
          
            
              ϕ
              ˙
            
          
        
        ∘
        
          ϕ
          
            −
            1
          
        
      
    
    {\displaystyle v={\dot {\phi }}\circ \phi ^{-1}}
   are in a vector spaces. Beg solved the dense image matching minimizing the action integral of kinetic energy of diffeomorphic flow while
minimizing endpoint matching term according to

Beg's Iterative Algorithm for Dense Image MatchingUpdate until convergence,  
  
    
      
        
          ϕ
          
            t
          
          
            o
            l
            d
          
        
        ←
        
          ϕ
          
            t
          
          
            n
            e
            w
          
        
      
    
    {\displaystyle \phi _{t}^{old}\leftarrow \phi _{t}^{new}}
   each iteration, with 
  
    
      
        
          ϕ
          
            t
            1
          
        
        ≐
        
          ϕ
          
            1
          
        
        ∘
        
          ϕ
          
            t
          
          
            −
            1
          
        
      
    
    {\displaystyle \phi _{t1}\doteq \phi _{1}\circ \phi _{t}^{-1}}
  :

This implies that the fixed point at 
  
    
      
        t
        =
        0
      
    
    {\displaystyle t=0}
   satisfies 

  
    
      
        
          μ
          
            0
          
          
            ∗
          
        
        =
        A
        
          v
          
            0
          
          
            ∗
          
        
        =
        (
        I
        −
        J
        ∘
        
          ϕ
          
            1
          
          
            ∗
          
        
        )
        ∇
        I
        
          |
        
        D
        
          ϕ
          
            1
          
          
            ∗
          
        
        
          |
        
      
    
    {\displaystyle \mu _{0}^{*}=Av_{0}^{*}=(I-J\circ \phi _{1}^{*})\nabla I|D\phi _{1}^{*}|}
  ,which in turn implies it satisfies the Conservation equation given by the Endpoint Matching Condition according to 

  
    
      
        A
        
          v
          
            t
          
          
            ∗
          
        
        =
        (
        D
        
          ϕ
          
            t
          
          
            ∗
            −
            1
          
        
        
          )
          
            T
          
        
        A
        
          v
          
            0
          
          
            ∗
          
        
        ∘
        
          ϕ
          
            t
          
          
            ∗
            −
            1
          
        
        
          |
        
        D
        
          ϕ
          
            t
          
          
            ∗
            −
            1
          
        
        
          |
        
      
    
    {\displaystyle Av_{t}^{*}=(D\phi _{t}^{*-1})^{T}Av_{0}^{*}\circ \phi _{t}^{*-1}|D\phi _{t}^{*-1}|}
  


=== LDDMM registered landmark matching ===
The landmark matching problem has a pointwise correspondence defining the endpoint condition with geodesics given by the following minimum:

  
    
      
        
          min
          
            v
            :
            
              
                
                  
                    ϕ
                    ˙
                  
                
              
              
                t
              
            
            =
            
              v
              
                t
              
            
            ∘
            
              ϕ
              
                t
              
            
          
        
        C
        (
        v
        )
        ≐
        
          
            1
            2
          
        
        
          ∫
          
            0
          
          
            1
          
        
        
          ∫
          
            
              R
              
                3
              
            
          
        
        A
        
          v
          
            t
          
        
        ⋅
        
          v
          
            t
          
        
        d
        x
        d
        t
        +
        
          
            1
            2
          
        
        
          ∑
          
            i
          
        
        (
        
          ϕ
          
            1
          
        
        (
        
          x
          
            i
          
        
        )
        −
        
          y
          
            i
          
        
        )
        ⋅
        (
        
          ϕ
          
            1
          
        
        (
        
          x
          
            i
          
        
        )
        −
        
          y
          
            i
          
        
        )
      
    
    {\displaystyle \min _{v:{\dot {\phi }}_{t}=v_{t}\circ \phi _{t}}C(v)\doteq {\frac {1}{2}}\int _{0}^{1}\int _{R^{3}}Av_{t}\cdot v_{t}dxdt+{\frac {1}{2}}\sum _{i}(\phi _{1}(x_{i})-y_{i})\cdot (\phi _{1}(x_{i})-y_{i})}
  ;Iterative Algorithm for Landmark MatchingJoshi originally defined the registered landmark matching probleme,. Update until convergence,  
  
    
      
        
          ϕ
          
            t
          
          
            o
            l
            d
          
        
        ←
        
          ϕ
          
            t
          
          
            n
            e
            w
          
        
      
    
    {\displaystyle \phi _{t}^{old}\leftarrow \phi _{t}^{new}}
   each iteration, with 
  
    
      
        
          ϕ
          
            t
            1
          
        
        ≐
        
          ϕ
          
            1
          
        
        ∘
        
          ϕ
          
            t
          
          
            −
            1
          
        
      
    
    {\displaystyle \phi _{t1}\doteq \phi _{1}\circ \phi _{t}^{-1}}
  :

This implies that the fixed point satisfy 

  
    
      
        A
        
          v
          
            0
          
        
        =
        −
        
          ∑
          
            i
          
        
        (
        D
        
          ϕ
          
            1
          
        
        )
        (
        
          x
          
            i
          
        
        
          )
          
            T
          
        
        (
        
          y
          
            i
          
        
        −
        
          ϕ
          
            1
          
        
        (
        
          x
          
            i
          
        
        )
        )
        
          δ
          
            
              x
              
                i
              
            
          
        
      
    
    {\displaystyle Av_{0}=-\sum _{i}(D\phi _{1})(x_{i})^{T}(y_{i}-\phi _{1}(x_{i}))\delta _{x_{i}}}
  with

  
    
      
        A
        
          v
          
            t
          
        
        =
        −
        
          ∑
          
            i
          
        
        (
        D
        
          ϕ
          
            t
            1
          
        
        
          )
          
            T
          
        
        
          
            |
          
          
            
              ϕ
              
                t
              
            
            (
            
              x
              
                i
              
            
            )
          
        
        (
        
          y
          
            i
          
        
        −
        
          ϕ
          
            1
          
        
        (
        
          x
          
            i
          
        
        )
        )
        
          δ
          
            
              ϕ
              
                t
              
            
            (
            
              x
              
                i
              
            
            )
          
        
      
    
    {\displaystyle Av_{t}=-\sum _{i}(D\phi _{t1})^{T}|_{\phi _{t}(x_{i})}(y_{i}-\phi _{1}(x_{i}))\delta _{\phi _{t}(x_{i})}}
  .


=== Variations for LDDMM dense image and landmark matching ===
The Calculus of variations was used in Beg[49]  to derive the iterative algorithm as a solution which when it converges satisfies the necessary maximizer conditions given by the  necessary conditions for a first order variation requiring the variation of the endpoint with respect to a first order variation of the vector field. The directional derivative calculates the Gateaux derivative as calculated in Beg's original paper[49] and.


== LDDMM Diffusion Tensor Image Matching ==
LDDMM matching based on the principal eigenvector of the diffusion tensor matrix
takes the image 
  
    
      
        I
        (
        x
        )
        ,
        x
        ∈
        
          
            
              R
            
          
          
            3
          
        
      
    
    {\displaystyle I(x),x\in {\mathbb {R} }^{3}}
   as a unit vector field defined by the first eigenvector.

The group action becomes

  
    
      
        φ
        ⋅
        I
        =
        
          
            {
            
              
                
                  
                    
                      
                        
                          D
                          
                            
                              φ
                              
                                −
                                1
                              
                            
                          
                        
                        φ
                        I
                        ∘
                        
                          φ
                          
                            −
                            1
                          
                        
                        ‖
                        I
                        ∘
                        
                          φ
                          
                            −
                            1
                          
                        
                        ‖
                      
                      
                        ‖
                        
                          D
                          
                            
                              φ
                              
                                −
                                1
                              
                            
                          
                        
                        φ
                        I
                        ∘
                        
                          φ
                          
                            −
                            1
                          
                        
                        ‖
                      
                    
                  
                
                
                  I
                  ∘
                  φ
                  ≠
                  0
                  ,
                
              
              
                
                  0
                
                
                  
                    otherwise.
                  
                
              
            
            
          
        
      
    
    {\displaystyle \varphi \cdot I={\begin{cases}{\frac {D_{\varphi ^{-1}}\varphi I\circ \varphi ^{-1}\|I\circ \varphi ^{-1}\|}{\|D_{\varphi ^{-1}}\varphi I\circ \varphi ^{-1}\|}}&I\circ \varphi \neq 0,\\0&{\text{otherwise.}}\end{cases}}}
  where 
  
    
      
        ‖
        ⋅
        ‖
      
    
    {\displaystyle \|\cdot \|}
   that denotes image squared-error norm.
LDDMM matching based on the entire tensor matrix
 
has group action 
  
    
      
        φ
        ⋅
        M
        =
        (
        
          λ
          
            1
          
        
        
          
            
              
                e
                ^
              
            
          
          
            1
          
        
        
          
            
              
                e
                ^
              
            
          
          
            1
          
          
            T
          
        
        +
        
          λ
          
            2
          
        
        
          
            
              
                e
                ^
              
            
          
          
            2
          
        
        
          
            
              
                e
                ^
              
            
          
          
            2
          
          
            T
          
        
        +
        
          λ
          
            3
          
        
        
          
            
              
                e
                ^
              
            
          
          
            3
          
        
        
          
            
              
                e
                ^
              
            
          
          
            3
          
          
            T
          
        
        )
        ∘
        
          φ
          
            −
            1
          
        
        ,
      
    
    {\displaystyle \varphi \cdot M=(\lambda _{1}{\hat {e}}_{1}{\hat {e}}_{1}^{T}+\lambda _{2}{\hat {e}}_{2}{\hat {e}}_{2}^{T}+\lambda _{3}{\hat {e}}_{3}{\hat {e}}_{3}^{T})\circ \varphi ^{-1},}
   transformed eigenvectors

  
    
      
        
          
            
              
                
                  
                    
                      
                        e
                        ^
                      
                    
                  
                  
                    1
                  
                
              
              
                
                =
                
                  
                    
                      D
                      φ
                      
                        e
                        
                          1
                        
                      
                    
                    
                      ‖
                      D
                      φ
                      
                        e
                        
                          1
                        
                      
                      ‖
                    
                  
                
                 
                ,
                 
                 
                 
                
                  
                    
                      
                        e
                        ^
                      
                    
                  
                  
                    2
                  
                
                =
                
                  
                    
                      D
                      φ
                      
                        e
                        
                          2
                        
                      
                      −
                      ⟨
                      
                        
                          
                            
                              e
                              ^
                            
                          
                        
                        
                          1
                        
                      
                      ,
                      D
                      φ
                      
                        e
                        
                          2
                        
                      
                      ⟩
                      
                        
                          
                            
                              e
                              ^
                            
                          
                        
                        
                          1
                        
                      
                    
                    
                      ‖
                      D
                      φ
                      
                        e
                        
                          2
                        
                      
                      
                        ‖
                        
                          2
                        
                      
                      −
                      ⟨
                      
                        
                          
                            
                              e
                              ^
                            
                          
                        
                        
                          1
                        
                      
                      ,
                      D
                      φ
                      
                        e
                        
                          2
                        
                      
                      
                        ⟩
                        
                          2
                        
                      
                    
                  
                
                 
                ,
                 
                 
                 
                
                  
                    
                      
                        e
                        ^
                      
                    
                  
                  
                    3
                  
                
                =
                
                  
                    
                      
                        e
                        ^
                      
                    
                  
                  
                    1
                  
                
                ×
                
                  
                    
                      
                        e
                        ^
                      
                    
                  
                  
                    2
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\hat {e}}_{1}&={\frac {D\varphi e_{1}}{\|D\varphi e_{1}\|}}\ ,\ \ \ {\hat {e}}_{2}={\frac {D\varphi e_{2}-\langle {\hat {e}}_{1},D\varphi e_{2}\rangle {\hat {e}}_{1}}{\sqrt {\|D\varphi e_{2}\|^{2}-\langle {\hat {e}}_{1},D\varphi e_{2}\rangle ^{2}}}}\ ,\ \ \ {\hat {e}}_{3}={\hat {e}}_{1}\times {\hat {e}}_{2}\end{aligned}}}
  .


=== Dense matching problem onto principle eigenvector of DTI ===
The variational problem matching onto vector image 
  
    
      
        
          I
          
            ′
          
        
        (
        x
        )
        ,
        x
        ∈
        
          
            
              R
            
          
          
            3
          
        
      
    
    {\displaystyle I^{\prime }(x),x\in {\mathbb {R} }^{3}}
  with endpoint

  
    
      
        E
        (
        
          ϕ
          
            1
          
        
        )
        ≐
        α
        
          ∫
          
            
              
                
                  R
                
              
              
                3
              
            
          
        
        ‖
        
          ϕ
          
            1
          
        
        ⋅
        I
        −
        
          I
          
            ′
          
        
        
          ‖
          
            2
          
        
        
        d
        x
        +
        β
        
          ∫
          
            
              
                
                  R
                
              
              
                3
              
            
          
        
        (
        ‖
        
          ϕ
          
            1
          
        
        ⋅
        I
        ‖
        −
        ‖
        
          I
          
            ′
          
        
        ‖
        
          )
          
            2
          
        
        
        d
        x
        )
        .
      
    
    {\displaystyle E(\phi _{1})\doteq \alpha \int _{{\mathbb {R} }^{3}}\|\phi _{1}\cdot I-I^{\prime }\|^{2}\,dx+\beta \int _{{\mathbb {R} }^{3}}(\|\phi _{1}\cdot I\|-\|I^{\prime }\|)^{2}\,dx).}
  becomes

  
    
      
        
          min
          
            v
            :
            
              
                
                  ϕ
                  ˙
                
              
            
            ∘
            
              ϕ
              
                −
                1
              
            
          
        
        
          
            1
            2
          
        
        
          ∫
          
            0
          
          
            1
          
        
        
          ∫
          
            
              R
              
                3
              
            
          
        
        A
        
          v
          
            t
          
        
        ⋅
        
          v
          
            t
          
        
        d
        x
        d
        t
        +
        α
        
          ∫
          
            
              
                
                  R
                
              
              
                3
              
            
          
        
        ‖
        
          ϕ
          
            1
          
        
        ⋅
        I
        −
        
          I
          
            ′
          
        
        
          ‖
          
            2
          
        
        
        d
        x
        +
        β
        
          ∫
          
            
              
                
                  R
                
              
              
                3
              
            
          
        
        (
        ‖
        
          ϕ
          
            1
          
        
        ⋅
        I
        ‖
        −
        ‖
        
          I
          
            ′
          
        
        ‖
        
          )
          
            2
          
        
        
        d
        x
         
        .
      
    
    {\displaystyle \min _{v:{\dot {\phi }}\circ \phi ^{-1}}{\frac {1}{2}}\int _{0}^{1}\int _{R^{3}}Av_{t}\cdot v_{t}dxdt+\alpha \int _{{\mathbb {R} }^{3}}\|\phi _{1}\cdot I-I^{\prime }\|^{2}\,dx+\beta \int _{{\mathbb {R} }^{3}}(\|\phi _{1}\cdot I\|-\|I^{\prime }\|)^{2}\,dx\ .}
  


=== Dense matching problem onto DTI MATRIX ===
The variational problem matching onto: 
  
    
      
        
          M
          
            ′
          
        
        (
        x
        )
        ,
        x
        ∈
        
          
            
              R
            
          
          
            3
          
        
      
    
    {\displaystyle M^{\prime }(x),x\in {\mathbb {R} }^{3}}
    with endpoint 

  
    
      
        E
        (
        
          ϕ
          
            1
          
        
        )
        ≐
        
          ∫
          
            
              
                
                  R
                
              
              
                3
              
            
          
        
        ‖
        
          ϕ
          
            1
          
        
        ⋅
        M
        (
        x
        )
        −
        
          M
          
            ′
          
        
        (
        x
        )
        
          ‖
          
            F
          
          
            2
          
        
        d
        x
      
    
    {\displaystyle E(\phi _{1})\doteq \int _{{\mathbb {R} }^{3}}\|\phi _{1}\cdot M(x)-M^{\prime }(x)\|_{F}^{2}dx}
  with 
  
    
      
        ‖
        ⋅
        
          ‖
          
            F
          
        
      
    
    {\displaystyle \|\cdot \|_{F}}
   Frobenius norm, giving variational problem


== LDDMM ODF ==
High angular resolution diffusion imaging (HARDI) addresses the well-known limitation of DTI, that is, DTI can only reveal one dominant fiber orientation at each location. HARDI measures diffusion along 
  
    
      
        n
      
    
    {\displaystyle n}
   uniformly distributed directions on the sphere and can characterize more complex fiber geometries by reconstructing an orientation distribution function (ODF) that characterizes the angular profile of the diffusion probability density function of water molecules. The ODF is a function defined on a unit sphere, 
  
    
      
        
          
            
              S
            
          
          
            2
          
        
      
    
    {\displaystyle {\mathbb {S} }^{2}}
  . 
Denote the square-root ODF (
  
    
      
        
          
            ODF
          
        
      
    
    {\displaystyle {\sqrt {\text{ODF}}}}
  ) as 
  
    
      
        ψ
        (
        
          
            s
          
        
        )
      
    
    {\displaystyle \psi ({\bf {s}})}
  , where 
  
    
      
        ψ
        (
        
          
            s
          
        
        )
      
    
    {\displaystyle \psi ({\bf {s}})}
   is non-negative to ensure uniqueness and 
  
    
      
        
          ∫
          
            
              
                s
              
            
            ∈
            
              
                
                  S
                
              
              
                2
              
            
          
        
        
          ψ
          
            2
          
        
        (
        
          
            s
          
        
        )
        d
        
          
            s
          
        
        =
        1
      
    
    {\displaystyle \int _{{\bf {s}}\in {\mathbb {S} }^{2}}\psi ^{2}({\bf {s}})d{\bf {s}}=1}
  . The metric defines the distance between two 
  
    
      
        
          
            ODF
          
        
      
    
    {\displaystyle {\sqrt {\text{ODF}}}}
   functions 
  
    
      
        
          ψ
          
            1
          
        
        ,
        
          ψ
          
            2
          
        
        ∈
        Ψ
      
    
    {\displaystyle \psi _{1},\psi _{2}\in \Psi }
   as 

  
    
      
        
          
            
              
                ρ
                (
                
                  ψ
                  
                    1
                  
                
                ,
                
                  ψ
                  
                    2
                  
                
                )
                =
                ‖
                
                  log
                  
                    
                      ψ
                      
                        1
                      
                    
                  
                
                ⁡
                (
                
                  ψ
                  
                    2
                  
                
                )
                
                  ‖
                  
                    
                      ψ
                      
                        1
                      
                    
                  
                
                =
                
                  cos
                  
                    −
                    1
                  
                
                ⁡
                ⟨
                
                  ψ
                  
                    1
                  
                
                ,
                
                  ψ
                  
                    2
                  
                
                ⟩
                =
                
                  cos
                  
                    −
                    1
                  
                
                ⁡
                
                  (
                  
                    
                      ∫
                      
                        
                          
                            s
                          
                        
                        ∈
                        
                          
                            
                              S
                            
                          
                          
                            2
                          
                        
                      
                    
                    
                      ψ
                      
                        1
                      
                    
                    (
                    
                      
                        s
                      
                    
                    )
                    
                      ψ
                      
                        2
                      
                    
                    (
                    
                      
                        s
                      
                    
                    )
                    d
                    
                      
                        s
                      
                    
                  
                  )
                
                ,
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\rho (\psi _{1},\psi _{2})=\|\log _{\psi _{1}}(\psi _{2})\|_{\psi _{1}}=\cos ^{-1}\langle \psi _{1},\psi _{2}\rangle =\cos ^{-1}\left(\int _{{\bf {s}}\in {\mathbb {S} }^{2}}\psi _{1}({\bf {s}})\psi _{2}({\bf {s}})d{\bf {s}}\right),\end{aligned}}}
  where 
  
    
      
        ⟨
        ⋅
        ,
        ⋅
        ⟩
      
    
    {\displaystyle \langle \cdot ,\cdot \rangle }
   is the normal dot product between points in the sphere under the 
  
    
      
        
          
            L
          
          
            2
          
        
      
    
    {\displaystyle \mathrm {L} ^{2}}
   metric.
The template and target are denoted

  
    
      
        
          ψ
          
            
              t
              e
              m
              p
            
          
        
        (
        
          
            s
          
        
        ,
        x
        )
      
    
    {\displaystyle \psi _{\mathrm {temp} }({\bf {s}},x)}
  , 
  
    
      
        
          ψ
          
            
              t
              a
              r
              g
            
          
        
        (
        
          
            s
          
        
        ,
        x
        )
      
    
    {\displaystyle \psi _{\mathrm {targ} }({\bf {s}},x)}
  ,
  
    
      
        
          
            s
          
        
        ∈
        
          
            
              
                S
              
            
            
              2
            
          
        
      
    
    {\displaystyle {\bf {s}}\in {{\mathbb {S} }^{2}}}
  
  
    
      
        x
        ∈
        X
      
    
    {\displaystyle x\in X}
   indexed across the unit sphere and the image domain, with the target indexed similarly.
Define the variational problem assuming that two ODF volumes can be generated from one to another via flows of diffeomorphisms 
  
    
      
        
          ϕ
          
            t
          
        
      
    
    {\displaystyle \phi _{t}}
  , which are solutions of ordinary differential equations 

  
    
      
        
          
            
              
                ϕ
                ˙
              
            
          
          
            t
          
        
        =
        
          v
          
            t
          
        
        (
        
          ϕ
          
            t
          
        
        )
        ,
        t
        ∈
        [
        0
        ,
        1
        ]
        ,
        
          ϕ
          
            0
          
        
        =
        
          i
          d
        
      
    
    {\displaystyle {\dot {\phi }}_{t}=v_{t}(\phi _{t}),t\in [0,1],\phi _{0}={id}}
  . 
The group action of the diffeomorphism on the template is given according to  

  
    
      
        
          ϕ
          
            1
          
        
        ⋅
        ψ
        (
        x
        )
        ≐
        (
        D
        
          ϕ
          
            1
          
        
        )
        ψ
        ∘
        
          ϕ
          
            1
          
          
            −
            1
          
        
        (
        x
        )
        ,
        x
        ∈
        X
      
    
    {\displaystyle \phi _{1}\cdot \psi (x)\doteq (D\phi _{1})\psi \circ \phi _{1}^{-1}(x),x\in X}
  ,
where 
  
    
      
        (
        D
        
          ϕ
          
            1
          
        
        )
      
    
    {\displaystyle (D\phi _{1})}
   is the Jacobian of the affined transformed ODF and is defined as

  
    
      
        
          
            
              
                (
                D
                
                  ϕ
                  
                    1
                  
                
                )
                ψ
                ∘
                
                  ϕ
                  
                    1
                  
                  
                    −
                    1
                  
                
                (
                x
                )
                =
                
                  
                    
                      
                        det
                        
                          
                            
                              (
                            
                          
                          
                            D
                            
                              
                                ϕ
                                
                                  1
                                
                                
                                  −
                                  1
                                
                              
                            
                          
                          
                            ϕ
                            
                              1
                            
                          
                          
                            
                              
                                )
                              
                            
                            
                              −
                              1
                            
                          
                        
                      
                      
                        
                          ‖
                          
                            
                              
                                
                                  (
                                
                              
                              
                                D
                                
                                  
                                    ϕ
                                    
                                      1
                                    
                                    
                                      −
                                      1
                                    
                                  
                                
                              
                              
                                ϕ
                                
                                  1
                                
                              
                              
                                
                                  
                                    )
                                  
                                
                                
                                  −
                                  1
                                
                              
                            
                            
                              
                                s
                              
                            
                          
                          ‖
                        
                        
                          3
                        
                      
                    
                  
                
                
                ψ
                
                  (
                  
                    
                      
                        
                          (
                          
                            D
                            
                              
                                ϕ
                                
                                  1
                                
                                
                                  −
                                  1
                                
                              
                            
                          
                          
                            ϕ
                            
                              1
                            
                          
                          
                            
                              
                                )
                              
                            
                            
                              −
                              1
                            
                          
                          
                            
                              s
                            
                          
                        
                        
                          ‖
                          (
                          
                            D
                            
                              
                                ϕ
                                
                                  1
                                
                                
                                  −
                                  1
                                
                              
                            
                          
                          
                            ϕ
                            
                              1
                            
                          
                          
                            
                              
                                )
                              
                            
                            
                              −
                              1
                            
                          
                          
                            
                              s
                            
                          
                          ‖
                        
                      
                    
                    ,
                    
                      ϕ
                      
                        1
                      
                      
                        −
                        1
                      
                    
                    (
                    x
                    )
                  
                  )
                
                .
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}(D\phi _{1})\psi \circ \phi _{1}^{-1}(x)={\sqrt {\frac {\det {{\bigl (}D_{\phi _{1}^{-1}}\phi _{1}{\bigr )}^{-1}}}{\left\|{{\bigl (}D_{\phi _{1}^{-1}}\phi _{1}{\bigr )}^{-1}}{\bf {s}}\right\|^{3}}}}\quad \psi \left({\frac {(D_{\phi _{1}^{-1}}\phi _{1}{\bigr )}^{-1}{\bf {s}}}{\|(D_{\phi _{1}^{-1}}\phi _{1}{\bigr )}^{-1}{\bf {s}}\|}},\phi _{1}^{-1}(x)\right).\end{aligned}}}
  The LDDMM variational problem is defined as

  
    
      
        
          
            
              
                
                  min
                  
                    v
                    :
                    
                      
                        
                          
                            ϕ
                            ˙
                          
                        
                      
                      
                        t
                      
                    
                    =
                    
                      v
                      
                        t
                      
                    
                    ∘
                    
                      ϕ
                      
                        t
                      
                    
                    ,
                    
                      ϕ
                      
                        0
                      
                    
                    =
                    
                      i
                      d
                    
                  
                
                
                  ∫
                  
                    0
                  
                  
                    1
                  
                
                
                  ∫
                  
                    
                      R
                      
                        3
                      
                    
                  
                
                A
                
                  v
                  
                    t
                  
                
                ⋅
                
                  v
                  
                    t
                  
                
                d
                x
                 
                d
                t
                +
                λ
                
                  ∫
                  
                    
                      R
                      
                        3
                      
                    
                  
                
                ‖
                
                  log
                  
                    (
                    D
                    
                      ϕ
                      
                        1
                      
                    
                    )
                    
                      ψ
                      
                        
                          t
                          e
                          m
                          p
                        
                      
                    
                    ∘
                    
                      ϕ
                      
                        1
                      
                      
                        −
                        1
                      
                    
                    (
                    x
                    )
                  
                
                ⁡
                (
                
                  ψ
                  
                    
                      t
                      a
                      r
                      g
                    
                  
                
                (
                x
                )
                )
                
                  ‖
                  
                    (
                    D
                    
                      ϕ
                      
                        1
                      
                    
                    )
                    
                      ψ
                      
                        
                          t
                          e
                          m
                          p
                        
                      
                    
                    ∘
                    
                      ϕ
                      
                        1
                      
                      
                        −
                        1
                      
                    
                    (
                    x
                    )
                  
                  
                    2
                  
                
                d
                x
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\min _{v:{\dot {\phi }}_{t}=v_{t}\circ \phi _{t},\phi _{0}={id}}\int _{0}^{1}\int _{R^{3}}Av_{t}\cdot v_{t}dx\ dt+\lambda \int _{R^{3}}\|\log _{(D\phi _{1})\psi _{\mathrm {temp} }\circ \phi _{1}^{-1}(x)}(\psi _{\mathrm {targ} }(x))\|_{(D\phi _{1})\psi _{\mathrm {temp} }\circ \phi _{1}^{-1}(x)}^{2}dx\end{aligned}}}
  .


== Hamiltonian LDDMM for dense image matching ==
Beg solved the early LDDMM algorithms by solving the variational matching taking variations with respect to the vector fields. Another solution by Vialard, reparameterizes the optimization problem in terms of the state 
  
    
      
        
          q
          
            t
          
        
        ≐
        I
        ∘
        
          ϕ
          
            t
          
          
            −
            1
          
        
        ,
        
          q
          
            0
          
        
        =
        I
      
    
    {\displaystyle q_{t}\doteq I\circ \phi _{t}^{-1},q_{0}=I}
  , for image 
  
    
      
        I
        (
        x
        )
        ,
        x
        ∈
        X
        =
        
          R
          
            3
          
        
      
    
    {\displaystyle I(x),x\in X=R^{3}}
  , with the dynamics equation controlling the state by the control given in terms of the advection equation according to 
  
    
      
        
          
            
              
                q
                ˙
              
            
          
          
            t
          
        
        =
        −
        ∇
        
          q
          
            t
          
        
        ⋅
        
          v
          
            t
          
        
      
    
    {\displaystyle {\dot {q}}_{t}=-\nabla q_{t}\cdot v_{t}}
  . The endpoint  matching term

  
    
      
        E
        (
        
          q
          
            1
          
        
        )
        ≐
        
          
            1
            2
          
        
        ‖
        
          q
          
            1
          
        
        −
        J
        
          ‖
          
            2
          
        
      
    
    {\displaystyle E(q_{1})\doteq {\frac {1}{2}}\|q_{1}-J\|^{2}}
   gives the variational problem:


== Software for diffeomorphic mapping ==
Software suites containing a variety of diffeomorphic mapping algorithms include the following:

Deformetrica
ANTS
DARTEL Voxel-based morphometry(VBM)
DEMONS
LDDMM
StationaryLDDMM


=== Cloud software ===
MRICloud


== See also ==
Computational anatomy § Dense image matching in computational anatomy
Riemannian metric and Lie-bracket in computational anatomy
Bayesian model of computational anatomy


== References ==


== Further reading ==
Ceritoglu, Can; Wang, Lei; Selemon, Lynn D.; Csernansky, John G.; Miller, Michael I.; Ratnanather, J. Tilak (2010-05-28). "Large Deformation Diffeomorphic Metric Mapping Registration of Reconstructed 3D Histological Section Images and in vivo MR Images". Frontiers in Human Neuroscience. 4: 43. doi:10.3389/fnhum.2010.00043. ISSN 1662-5161. PMC 2889720. PMID 20577633.